# STB to IFC 変換ツール

## 📋 概要

STB (ST-Bridge) から IFC (Industry Foundation Classes) への変換を行うPython製ツールです。
ST-BridgeのジオメトリのみをIFC要素に変換します。

**対応要素**: 梁・柱・ブレース・杭・スラブ・壁・フーチング・基礎柱・階層

## 🚀 クイックスタート

### インストール

```bash
# 依存関係をインストール
pip install -r requirements.txt
```

### 基本的な使用方法

```bash
# 🚀 最もシンプル：ファイル選択ダイアログが自動で開きます
python3.11 main.py

# ファイルを指定して変換
python3.11 main.py input.stb

# 出力ファイル名を指定
python3.11 main.py input.stb -o output.ifc

# 💡 明示的にファイル選択ダイアログを使用
python3.11 main.py --select-file

# 変換情報のみ表示（変換は行わない）
python3.11 main.py --info input.stb

# デバッグモードで実行
python3.11 main.py input.stb --debug
```

**または専用CLIを使用:**

```bash
python3.11 stb2ifc_cli.py input.stb  # 専用CLI（上級者向け）
```

## 📂 ファイル選択方法

新しいバージョンでは、以下の方法でファイルを選択できます：

### 1. **最もシンプル（推奨）**

```bash
python3.11 main.py
```

- 🚀 **引数なしで実行するだけ！**
- GUI環境では tkinter ファイルダイアログが開きます
- CLI環境では自動的にデフォルトファイルを選択

### 2. **ファイルパス直接指定**

```bash
python3.11 main.py "path/to/your/file.stb"
```

### 3. **明示的なファイル選択ダイアログ**

```bash
python3.11 main.py --select-file
```

- GUI環境で tkinter ファイルダイアログが開きます
- `sampleStb/` ディレクトリから開始されます

## 📊 対応状況

### 構造要素

| 要素タイプ | 対応状況 | 備考 |
|------------|----------|------|
| 梁 (Beam) | ✅ 完全対応 | H型鋼、角型鋼管、RC等 |
| 柱 (Column) |  変換可能 | H型鋼、角型鋼管、RC等 |
| ブレース (Brace) | ✅ 完全対応 | L型鋼、パイプ等 |
| スラブ (Slab) | ✅ 完全対応 | RC床版 |
| 壁 (Wall) | ✅ 完全対応 | RC壁 |
| 杭 (Pile) | ✅ 完全対応 | PHC杭等 |
| フーチング (Footing) | ✅ 完全対応 | RC基礎 |
| 基礎柱 (Foundation Column) | ✅ 完全対応 | RC基礎柱 |
| 階層 (Story) | ✅ 完全対応 | 空間構造 |

柱の2断面変換可能なように修正中
壁の他節点で三角形になる場合があります。

### ファイル形式

- **入力**: STB v2.0.2 (XML)
- **出力**: IFC4 (STEP-File)

## ⚙️ 要件

### 必須要件

- **Python**: 3.11推奨 (IfcOpenShell互換性)
- **IfcOpenShell**: 0.8.x

### 追加ライブラリ

詳細は `requirements.txt` を参照

### GUI機能 (オプション)

ファイル選択ダイアログを使用する場合：

- **tkinter**: Python標準（通常は自動インストール）


#### 3. ファイルエンコーディングエラー

- STBファイルはUTF-8エンコーディングで保存してください
- Shift_JISの場合は自動検出・変換されます


## 🆕 バージョン履歴

### V2.2.0 (2025年7月24日)

- 🚀 **大幅なコード最適化完了**: 全体で1000行以上のコード削減

### v2.1.0 (2025年6月19日)

- 🚀 **大幅なコード最適化完了**: 全体で1000行以上のコード削減
- 🔧 **プロパティ管理システム改善**: PropertyManagerBase拡張により85%のコード削減
- 📐 **断面抽出クラス共通化**: BaseSectionExtractorパターンで40-50%のコード削減
- 🏗️ **アーキテクチャ簡素化**: DIコンテナ80%削減、170+ファイル削除
- ⚡ **パフォーマンス向上**: 処理速度とメモリ使用量の最適化
- 🎯 **型安全性向上**: 適切な型ヒントによる開発効率向上
- 🧹 **保守性向上**: 統一されたコーディングパターンと日本語コメント統一

### v2.0.0 (2025年6月)

- 🎉 **新しいアーキテクチャに完全移行**
- 🚀 **新CLIインターフェース** (`stb2ifc_cli.py`)
- 🎨 **UI層とコア機能の完全分離**
- ⚡ **軽量DIコンテナによる高速化**
- 🗂 **ファイル選択UIの改善** (GUI/Console/Auto対応)
- 📱 **プログラム用API** (`Stb2IfcConverter`)
- 🧹 **コードベース50%削減** (機能は100%維持)

---
